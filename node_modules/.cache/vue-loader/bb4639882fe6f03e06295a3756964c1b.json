{"remainingRequest":"G:\\webstore\\vue-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!G:\\webstore\\vue-admin\\src\\views\\power\\Roles.vue?vue&type=style&index=0&id=2520f369&scoped=true&lang=css&","dependencies":[{"path":"G:\\webstore\\vue-admin\\src\\views\\power\\Roles.vue","mtime":1630833568030},{"path":"G:\\webstore\\vue-admin\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\webstore\\vue-admin\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"G:\\webstore\\vue-admin\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"G:\\webstore\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\webstore\\vue-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5lbC10YWd7DQogIG1hcmdpbjogN3B4Ow0KfQ0KLmJkdG9wew0KICBib3JkZXItdG9wOiAxcHggc29saWQgI2VlZTsNCn0NCi5iZGJvdHRwbXsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7DQp9DQoudmNlbnRlcnsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg=="},{"version":3,"sources":["Roles.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Roles.vue","sourceRoot":"src/views/power","sourcesContent":["<template>\r\n<div>\r\n  <!--  面包屑导航区域-->\r\n  <el-breadcrumb separator=\"/\">\r\n    <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\r\n    <el-breadcrumb-item>权限管理</el-breadcrumb-item>\r\n    <el-breadcrumb-item>角色列表</el-breadcrumb-item>\r\n  </el-breadcrumb>\r\n\r\n<!--  卡片视图-->\r\n  <el-card>\r\n<!--    添加角色按钮区域-->\r\n    <el-row>\r\n      <el-col>\r\n        <el-button type=\"primary\"  @click=\"addDialogVisible=true\">添加角色</el-button>\r\n      </el-col>\r\n    </el-row>\r\n\r\n<!--    角色列表区域-->\r\n    <el-table :data=\"rolelist\" border stripe>\r\n<!--      展开列-->\r\n      <el-table-column type=\"expand\">\r\n        <template v-slot:default=\"{row}\">\r\n          <el-row :class=\"['bdbottpm',i1===0?'.bdtop':''  ,'vcenter']\"  v-for=\"(item1,i1) in row.children\" :key=\"item1.id\">\r\n<!--            渲染一级权限 :span=\"5占5列  判断索引值第一个是否为0 是则加上顶边框-->\r\n            <el-col  :span=\"5\">\r\n              <el-tag closable @close=\"removeRightByid(row,item1.id)\">{{item1.authName}}</el-tag>\r\n              <i class=\"el-icon-caret-right\"></i>\r\n            </el-col>\r\n<!--            渲染二级，三级权限-->\r\n            <el-col :span=\"19\">\r\n<!--            通过for循环嵌套渲染二级权限-->\r\n              <el-row :class=\"[i2===0?'':'bdtop','vcenter']\" v-for=\"(item2,i2) in item1.children\" :key=\"item2.id\">\r\n                <el-col :span=\"6\">\r\n                  <el-tag closable @close=\"removeRightByid(row,item2.id)\" type=\"success\">{{item2.authName}}</el-tag>\r\n                  <i class=\"el-icon-caret-right\"></i>\r\n                </el-col>\r\n                <el-col :span=\"18\">\r\n<!--                  @close elementui内部语法-->\r\n                  <el-tag closable @close=\"removeRightByid(row,item3.id)\" type=\"warning\" v-for=\"(item3,i3) in item2.children\" :key=\"item3.id\">{{item3.authName}}</el-tag>\r\n                </el-col>\r\n              </el-row>\r\n            </el-col>\r\n          </el-row>\r\n        </template>\r\n      </el-table-column>\r\n<!--      索引列-->\r\n      <el-table-column type=\"index\"></el-table-column>\r\n      <el-table-column label=\"角色名称\" prop=\"roleName\"></el-table-column>\r\n      <el-table-column label=\"角色描述\" prop=\"roleDesc\"></el-table-column>\r\n      <el-table-column label=\"操作\" width=\"300px\">\r\n        <template v-slot:default=\"{row}\">\r\n          <el-button size=\"mini\" @click=\"showEditDialog(row.id)\" type=\"primary\" icon=\"el-icon-edit\">编辑</el-button>\r\n          <el-button size=\"mini\" @click=\"removeById(row.id)\"   type=\"danger\" icon=\"el-icon-delete\">删除</el-button>\r\n          <el-button @click=\"showSetRightDialog(row)\" size=\"mini\"  type=\"warning\" icon=\"el-icon-setting\">分配权限</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n  </el-card>\r\n\r\n  <!--  添加角色的对话框-->\r\n<!--  :visible.sync控制添加角色对话框的显示和隐藏-->\r\n  <el-dialog\r\n          title=\"添加角色\"\r\n          :visible.sync=\"addDialogVisible\"\r\n          width=\"50%\">\r\n    <!--    内容主题区域-->\r\n    <el-form :model=\"addForm\" :rules=\"addRulesRules\"\r\n             ref=\"addRulesRef\" label-width=\"80px\">\r\n      <el-form-item  label=\"角色名称\" prop=\"roleName\">\r\n        <el-input v-model=\"addForm.roleName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"角色描述\" prop=\"roleDesc\">\r\n        <el-input v-model=\"addForm.roleDesc\"></el-input>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!--    底部区域-->\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n<!--   按钮关闭属性   @click=\"addDialogVisible = false\"-->\r\n    <el-button @click=\"addDialogVisible = false\">取消</el-button>\r\n    <el-button type=\"primary\" @click=\"addRules\">确 定</el-button>\r\n  </span>\r\n  </el-dialog>\r\n\r\n  <!--  修改用户的对话框-->\r\n  <el-dialog\r\n          title=\"修改角色\"\r\n          :visible.sync=\"editDialogVisiblle\"\r\n          width=\"50%\">\r\n    <!--    内容主题区域-->\r\n    <el-form :model=\"editForm\" :rules=\"addRulesRules\"\r\n             ref=\"editFormRef\" label-width=\"70px\">\r\n      <el-form-item  label=\"角色名称\" prop=\"roleName\">\r\n        <el-input v-model=\"editForm.roleName\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"角色描述\" prop=\"roleDesc\">\r\n        <el-input v-model=\"editForm.roleDesc\"></el-input>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!--    底部区域-->\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n<!--   按钮关闭属性   @click=\"addDialogVisible = false\"-->\r\n    <el-button @click=\"editDialogVisiblle = false\">取消</el-button>\r\n    <el-button type=\"primary\" @click=\"editUserinfo\">确 定</el-button>\r\n  </span>\r\n  </el-dialog>\r\n\r\n  <!--  分配权限的对话框-->\r\n  <el-dialog @close=\"setRightDialogClosed\"\r\n          title=\"分配权限\"\r\n          :visible.sync=\"setRightDialogVisiblle\"\r\n          width=\"50%\">\r\n    <!--    树形控件-->\r\n    <el-tree ref=\"treeRef\" :default-checked-keys=\"defkeys\" default-expand-all node-key=\"id\" show-checkbox :data=\"rightsList\" :props=\"treeProps\" ></el-tree>\r\n    <!--    底部区域-->\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n<!--   按钮关闭属性   @click=\"addDialogVisible = false\"-->\r\n    <el-button @click=\"editDialogVisiblle = false\">取消</el-button>\r\n    <el-button type=\"primary\" @click=\"allotRights\">确 定</el-button>\r\n  </span>\r\n  </el-dialog>\r\n</div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    name: \"Roles\",\r\n    data() {\r\n      //验证邮箱校验规则\r\n      let checkEmail=(rule,value,callback)=>{\r\n        const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/\r\n        if(regEmail.test(value)){\r\n          //合法的邮箱\r\n          return callback()\r\n        }\r\n        callback(new Error('请输入合法的邮箱'))\r\n      }\r\n      //验证手机号校验规则\r\n      let checkMobile=(rule,value,callback)=>{\r\n        // 验证手机号的正则表达式\r\n        const regMobile = /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/\r\n        //如果regMobile的test方法中value经过校验合法的手机号\r\n        if (regMobile.test(value)) {\r\n          //执行callback方法\r\n          return callback()\r\n        }\r\n\r\n        callback(new Error('请输入合法的手机号'))\r\n      }\r\n      return {\r\n        //所有角色列表数据\r\n        rolelist: [],\r\n        //添加角色的表单数据\r\n        addForm: {\r\n          roleId: '',\r\n          roleName: '',\r\n          roleDesc: ''\r\n        },\r\n        //查询到的角色信息对象\r\n        editForm:{},\r\n        //控制添加角色对话框的显示和隐藏\r\n        addDialogVisible: false,\r\n        //控制修改用户对话框的显示和隐藏\r\n        editDialogVisiblle:false,\r\n        //控制分配权限对话框的显示和隐藏\r\n        setRightDialogVisiblle:false,\r\n        //所有权限的数据\r\n        rightsList:[],\r\n        //树形控件的属性绑定对象\r\n        treeProps:{\r\n          //label展示可看到的属性\r\n          label:'authName',\r\n          //父子节点通过children属性实现嵌套\r\n          children:'children'\r\n        },\r\n        //默认选中节点的id值数组\r\n        defkeys:[],\r\n        //当前即将分配权限的角色id\r\n        roleId:'',\r\n        //添加用户表单的规则对象\r\n        addRulesRules: {\r\n          roleName: [\r\n            {required: true, message: '请输入角色名', trigger: 'blur'},\r\n            {min: 3, max: 10, message: '用户名长度在 3 到 10 个字符之间', trigger: 'blur'}\r\n          ],\r\n        },\r\n      }\r\n    },\r\n    created() {\r\n      this.getRolesList()\r\n    },\r\n    methods: {\r\n      //获取所有角色的列表\r\n      getRolesList() {\r\n        this.$http.get('roles')\r\n          .then(res => {\r\n            // console.log(res.data.data)\r\n            if (res.data.meta.status !== 200) {\r\n              return this.$message.error('获取角色列表失败');\r\n            }\r\n            this.rolelist = res.data.data\r\n          })\r\n      },\r\n      //点击按钮，添加角色\r\n      addRules() {\r\n        this.$refs.addRulesRef.validate((valid) => {\r\n          // console.log(valid)\r\n          if (!valid) return\r\n          //可以发起添加用户的请求\r\n          this.$http.post('roles', this.addForm)\r\n            .then(res => {\r\n              // console.log(this.addRules)\r\n              console.log(res)\r\n              if (res.data.meta.status !== 201) {\r\n                return this.$message.error('添加用户失败');\r\n              }\r\n              this.$message.success('添加用户成功')\r\n              //隐藏添加用户的对话框\r\n              this.addDialogVisible = false\r\n              //重新获取用户列表\r\n              this.getRolesList()\r\n            })\r\n        })\r\n      },\r\n      //展示编辑角色的对话框\r\n      showEditDialog(id){\r\n        // console.log( id)\r\n        this.$http.get('roles/'+id)\r\n          .then(res=> {\r\n            // console.log(res.data.data)\r\n            if (res.data.meta.status !== 200) {\r\n              return this.$message.error('查询用户信息失败');\r\n            }\r\n            this.editForm=res.data.data\r\n            this.editDialogVisiblle=true\r\n          })\r\n      },\r\n      //修改角色信息并提交\r\n      editUserinfo(){\r\n      //获取表单预校验结果为true提交\r\n        this.$refs.editFormRef.validate(vaild=>{\r\n          if (!vaild) return\r\n          //发起修改用户信息的数据请求\r\n          this.$http.put(`roles/`+this.editForm.roleId,{\r\n            roleName:this.editForm.roleName,\r\n            roleDesc:this.editForm.roleDesc\r\n          })\r\n            .then(res=> {\r\n              if (res.data.meta.status !== 200) {\r\n                return this.$message.error('更新用户信息失败');\r\n              }\r\n              this.$message.success('更新用户信息成功')\r\n              //隐藏添加用户的对话框\r\n              this.editDialogVisiblle=false\r\n              //重新获取用户列表\r\n              this.getRolesList()\r\n            })\r\n        })\r\n      },\r\n      //根据id删除对应的角色信息\r\n      removeById(id){\r\n        //弹框询问是否删除\r\n        this.$confirm('此操作将永久删除该用户, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$http.delete(`roles/`+id)\r\n            .then(res=> {\r\n              if (res.data.meta.status !== 200) {\r\n                return this.$message.error('删除角色失败');\r\n              }\r\n              this.$message.success('删除角色成功')\r\n              //删除成功后刷新数据列表\r\n              this.getRolesList();\r\n            })\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          });\r\n        });\r\n      },\r\n      //根据id删除对应的权限\r\n      removeRightByid(role,rightId){\r\n       //弹框提示是否删除\r\n        this.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '删除成功!',\r\n          });\r\n          this.$http.delete(`roles/${role.id}/rights/${rightId}`)\r\n            .then(res=> {\r\n              // console.log(res.data)\r\n              // console.log(role.children)\r\n              if (res.data.meta.status !== 200) {\r\n                return this.$message.error('删除角色失败');\r\n              }\r\n              //删除成功后刷新数据列表\r\n              role.children=res.data.data\r\n            })\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          });\r\n        });\r\n      },\r\n      //展示分配权限的对话框\r\n      showSetRightDialog(role){\r\n        //保存选中节点id\r\n        this.roleId=role.id\r\n        //获取所有权限数据\r\n        this.$http.get('rights/tree')\r\n          .then(res=> {\r\n            if (res.data.meta.status !== 200) {\r\n              return this.$message.error('获取权限列表失败');\r\n            }\r\n            //把获取到的权限数据保存到data中\r\n            this.rightsList=res.data.data\r\n            // console.log(this.rightsList)\r\n          })\r\n        //递归获取三级节点\r\n        this.getLeafKeys(role,this.defkeys)\r\n        this.setRightDialogVisiblle=true\r\n      },\r\n      //通过递归的形式获取角色下所有三级权限的id\r\n      //并保存到defkeys数组中\r\n      getLeafKeys(node,arr){\r\n      //如果当前node节点不包含children属性\r\n      //则是三级节点\r\n        if(!node.children){\r\n          return arr.push(node.id)\r\n        }\r\n\r\n        node.children.forEach(item=>\r\n          this.getLeafKeys(item,arr))\r\n      },\r\n      //监听分配权限对话框的关闭事件\r\n      setRightDialogClosed(){\r\n        this.defkeys=[]\r\n      },\r\n      //点击确定为角色分配权限 ...展开运算符\r\n      allotRights(){\r\n        const keys=[\r\n          ...this.$refs.treeRef.getCheckedKeys(),\r\n          ...this.$refs.treeRef.getHalfCheckedKeys()\r\n        ]\r\n        const idStr=keys.join(',')\r\n        this.$http.post(`roles/${this.roleId}/rights`,{\r\n          rids:idStr\r\n        })\r\n          .then(res=> {\r\n            // console.log(res)\r\n            if (res.data.meta.status !== 200) {\r\n              return this.$message.error('分配权限失败');\r\n            }\r\n            this.$message.success('分配权限成功')\r\n            this.getRolesList()\r\n            this.setRightDialogVisiblle=false\r\n          })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n.el-tag{\r\n  margin: 7px;\r\n}\r\n.bdtop{\r\n  border-top: 1px solid #eee;\r\n}\r\n.bdbottpm{\r\n  border-bottom: 1px solid #eee;\r\n}\r\n.vcenter{\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n</style>"]}]}